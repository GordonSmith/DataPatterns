define(["exports","@hpcc-js/comms","@hpcc-js/phosphor","@hpcc-js/layout","@hpcc-js/html","@hpcc-js/other","@hpcc-js/chart","@hpcc-js/common"],(function(t,e,i,n,r,a,o,l){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function u(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var h=190,d={attributeDesc:1,statsData:1,breakdown:2/3,quartile:1,popularPatterns:1},c=13,p="#494949",f="#DDD",m="#FBFBFB",_="#1A99D5",v="#ED1C24",w=33,x=function(t){function e(e){var i=t.call(this)||this;return i.html('<span style="\n                color:'+p+";\n                padding:8px;\n                display:inline-block;\n                font-size:"+c+"px;\n                margin-top:4px;\n                border:1px solid "+f+";\n                border-radius:4px;\n                background-color: "+m+';\n                width: calc(100% - 18px);\n            ">\n                <i style="\n                    font-size:'+c+"px;\n                    color:"+_+';\n                " class="fa '+("string"===e.given_attribute_type.slice(0,6)?"fa-font":"fa-hashtag")+'"></i>\n                <b>'+e.attribute+'</b>\n                <span style="float:right;">'+e.given_attribute_type+'</span>\n            </span>\n            <span style="padding:12px 2px;display:inline-block;font-weight: bold;font-size: 13px;">\n                Optimal:\n            </span>\n            <span style="\n                color:'+p+";\n                padding:4px 8px;\n                display:inline-block;\n                font-size:"+c+"px;\n                margin-top:4px;\n                border:1px solid "+f+";\n                border-radius:4px;\n                background-color: "+m+';\n                float:right;\n            ">\n                <i style="\n                    font-size:'+c+"px;\n                    color:"+_+';\n                " class="fa '+("string"===e.best_attribute_type.slice(0,6)?"fa-font":"fa-hashtag")+'"></i>\n                '+e.best_attribute_type+"\n            </span>\n            ").overflowX("hidden").overflowY("hidden"),i}return u(e,t),e}(a.Html),g=function(t){function e(e){var i=t.call(this)||this,n=100===e.fill_rate||0===e.fill_rate?e.fill_rate:e.fill_rate.toFixed(1);return i.data([["Cardinality",e.cardinality,"(~"+(e.cardinality/e.fill_count*100).toFixed(0)+"%)"],["Filled",e.fill_count,n<=w?'(<b style="color:'+v+'">'+n+"%</b>)":"("+n+"%)"]]).tbodyColumnStyles([{"font-weight":"bold","font-size":c+"px",width:"1%"},{"font-weight":"normal","font-size":c+"px","text-align":"right",width:"auto"},{"font-weight":"normal","font-size":c+"px","text-align":"left",width:"1%"}]),i}return u(e,t),e}(r.StyledTable),b=function(t){function e(e){var i=t.call(this)||this;return i.gutter(0).surfaceShadow(!1).surfacePadding("0").surfaceBorderWidth(0).setContent(0,0,new x(e)).setContent(1,0,new g(e)),i}return u(e,t),e}(n.Grid),y=function(t){function e(e,i){void 0===i&&(i=!0);var n=t.call(this)||this;return i&&n.columns(["Cardinality",""]),n.theadColumnStyles([{"text-align":"left","font-size":c+"px","white-space":"nowrap"}]).tbodyColumnStyles([{"font-weight":"normal","max-width":"60px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},{"font-size":c+"px","font-weight":"normal","text-align":"right"}]).data(e.map((function(t){return[t.value.trim(),t.rec_count]}))),n}return u(e,t),e}(r.BreakdownTable),D=function(t){function e(e,i){var n=t.call(this)||this;return n.html('\n                <b style="line-height:23px;font-size:'+c+'px;color: rgb(51, 51, 51);">'+e+'</b>\n                <br/>\n                <i style="font-size:'+c+'px;color: rgb(51, 51, 51);">'+i+"</i>\n            ").overflowX("hidden").overflowY("hidden"),n}return u(e,t),e}(a.Html),C=function(t){function e(e,i){void 0===i&&(i=!0);var n=t.call(this)||this;return i&&n.columns(["Popular Patterns",""]),n.theadColumnStyles([{"font-size":c+"px","text-align":"left","white-space":"nowrap"}]).tbodyColumnStyles([{"font-weight":"normal","max-width":"60px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},{"font-size":c+"px","font-weight":"normal","text-align":"right"}]).data(e.map((function(t){return[t.data_pattern.trim(),t.rec_count]}))),n}return u(e,t),e}(r.BreakdownTable),S=l.Palette.rainbow("Blues"),k=l.Palette.ordinal("Quartile",[S(100,0,100),S(50,0,100),S(50,0,100),S(75,0,100)]);k("Std. Dev."),k("MinMax"),k("25%"),k("50%");var q=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._bellCurve=(new o.Scatter).columns(["","Std. Dev."]).paletteID("Quartile").interpolate_default("basis").pointSize(0).xAxisType("linear").xAxisOverlapMode("none").xAxisTickFormat(".2s").yAxisHidden(!0).yAxisDomainLow(0).yAxisDomainHigh(110).yAxisGuideLines(!1),e._candle=(new o.QuartileCandlestick).columns(["Min","25%","50%","75%","Max"]).edgePadding(0).candleWidth(16).roundedCorners(1).lineWidth(1).upperTextRotation(-90).lowerTextRotation(-90).labelFontSize(0).valueFontSize(0).lineColor(S(90,0,100)).innerRectColor(S(10,0,100)),e}return u(e,t),e.prototype.stdDev=function(t){return this.mean()+t*this.standardDeviation()},e.prototype.formatStdDev=function(t){return this._tickFormatter(this.stdDev(t))},e.prototype.quartile=function(t){return this.quartiles()[t]},e.prototype.formatQ=function(t){return this._tickFormatter(this.quartile(t))},e.prototype.domain=function(t){switch(t){case"25_75":return[this.quartile(1),this.quartile(3)];case"normal":return[this.stdDev(-4),this.stdDev(4)];case"min_max":default:return[this.quartile(0),this.quartile(4)]}},e.prototype.enter=function(e,i){var n=this;t.prototype.enter.call(this,e,i),this._bellCurve.target(i.append("div").node()),this._candle.target(i.append("div").node()),this._selectMode=i.append("div").style("position","absolute").style("top","0px").style("right","0px").append("select").on("change",(function(){return n.render()})),this._selectMode.append("option").attr("value","min_max").text("Min / Max"),this._selectMode.append("option").attr("value","25_75").text("25% / 75%"),this._selectMode.append("option").attr("value","normal").text("Normal")},e.prototype.bellTicks=function(t){var e;switch(t){case"25_75":e=[{label:this.formatQ(1),value:this.quartile(1)},{label:this.formatQ(2),value:this.quartile(2)},{label:this.formatQ(3),value:this.quartile(3)}];break;case"normal":e=[{label:this.formatStdDev(-4),value:this.stdDev(-4)},{label:"-3σ",value:this.stdDev(-3)},{label:"-2σ",value:this.stdDev(-2)},{label:"-1σ",value:this.stdDev(-1)},{label:this.formatStdDev(0),value:this.stdDev(0)},{label:"+1σ",value:this.stdDev(1)},{label:"+2σ",value:this.stdDev(2)},{label:"+3σ",value:this.stdDev(3)},{label:this.formatStdDev(4),value:this.stdDev(4)}];break;case"min_max":default:e=[{label:this.formatQ(0),value:this.quartile(0)},{label:this.formatQ(1),value:this.quartile(1)},{label:this.formatQ(2),value:this.quartile(2)},{label:this.formatQ(3),value:this.quartile(3)},{label:this.formatQ(4),value:this.quartile(4)}]}var i=this.domain(this._selectMode.node().value),n=i[0],r=i[1];return e.filter((function(t){return t.value>=n&&t.value<=r})).map((function(t){return{label:t.label,value:t.value.toString()}}))},e.prototype.updateBellCurve=function(){var t=this._selectMode.node().value,e=this.domain(t),i=e[0],n=e[1],r=.1*(n-i);this._bellCurve.xAxisDomainLow(i-r).xAxisDomainHigh(n+r).xAxisTicks(this.bellTicks(t)).data([[this.stdDev(-4),0],[this.stdDev(-3),.3],[this.stdDev(-2),5],[this.stdDev(-1),68],[this.stdDev(0),100],[this.stdDev(1),68],[this.stdDev(2),5],[this.stdDev(3),.3],[this.stdDev(4),0]]).resize({width:this.width(),height:this.height()-20}).render()},e.prototype.updateCandle=function(){var t=this._bellCurve.dataPos(this.quartile(0)),e=this._bellCurve.dataPos(this.quartile(4))-t;this._candle.resize({width:this.width(),height:20}).pos({x:t+e/2,y:10}).width(e).data(this.quartiles()).render()},e.prototype.update=function(e,i){var n,r;t.prototype.update.call(this,e,i),this._tickFormatter=(n=this.tickFormat(),r=l.format(n),function(t){var e=(Math.round(100*t)/100).toString();return e.length<=4?e:r(t)}),this.updateBellCurve(),this.updateCandle()},e}(l.HTMLWidget);q.prototype.publish("tickFormat",".2e","string","X-Axis Tick Format"),q.prototype.publish("mean",0,"number","Mean"),q.prototype.publish("standardDeviation",0,"number","Standard Deviation"),q.prototype.publish("quartiles",[0,0,0,0,0],"array","Quartiles");var z=function(t){function e(e,i){var n=t.call(this)||this;return n.tbodyColumnStyles([{"font-weight":"bold","text-align":"right",width:"100px"},{"font-weight":"normal",width:i+"px"},{"font-weight":"normal",width:"auto"}]).data([["Mean",e.numeric_mean,""],["Std. Deviation",e.numeric_std_dev,""],["","",""],["Quartiles",e.numeric_min,"Min"],["",e.numeric_lower_quartile,"25%"],["",e.numeric_median,"50%"],["",e.numeric_upper_quartile,"75%"],["",e.numeric_max,"Max"]]),n}return u(e,t),e}(r.StyledTable),P=function(t){function e(e){t.call(this);return(new r.StyledTable).tbodyColumnStyles([{"font-weight":"bold","text-align":"right",width:"100px"},{"font-weight":"normal",width:"auto"}]).data([["Min Length",e.min_length],["Avg Length",e.ave_length],["Max Length",e.max_length]])}return u(e,t),e}(r.StyledTable),M=function(t){function e(e){var i=t.call(this)||this;return i._showBreakdownColumn=!0,i._showPopularPatternsColumn=!0,i._showQuartileColumn=!0,i._data=e,i.gutter(12).surfaceShadow(!1).surfacePadding("0").surfaceBorderWidth(0),i}return u(e,t),e.prototype.enter=function(e,i){var n=this;this._fixedHeight=this._data.length*h,e.style.height=this._fixedHeight+"px",this.height(this._fixedHeight),t.prototype.enter.call(this,e,i);var r=this.calcStatsWidgetDataColumnWidth();this._showQuartileColumn=this._data.filter((function(t){return t.is_numeric})).length>0,this._showBreakdownColumn=this._data.filter((function(t){return t.cardinality_breakdown.Row.length>0})).length>0,this._showPopularPatternsColumn=this._data.filter((function(t){return t.popular_patterns.Row.length>0})).length>0;var a=3;this._data.forEach((function(t,e){var i=n.enterDataRow(t,e,{statsDataWidth:r});i>a&&(a=i)})),i.classed("report-col-count-"+a,!0)},e.prototype.enterDataRow=function(t,e,i){var n=e*h,r=2,a=0;return this.setContent(n,a,new b(t),void 0,h,12*d.attributeDesc),a+=12*d.attributeDesc,this.setContent(n,a,function(t,e){if(t.is_numeric)return new z(t,e);if(t.popular_patterns.Row.length>0)return new P(t);return new b(t)}(t,i.statsDataWidth),void 0,h,12*d.statsData),a+=12*d.statsData,this._showQuartileColumn&&(this.setContent(n,a,function(t){return t.is_numeric?(new q).mean(t.numeric_mean).standardDeviation(t.numeric_std_dev).quartiles([t.numeric_min,t.numeric_lower_quartile,t.numeric_median,t.numeric_upper_quartile,t.numeric_max]):new D("Quartile","N/A")}(t),void 0,h,12*d.quartile),a+=12*d.quartile,++r),this._showBreakdownColumn&&(this.setContent(n,a,function(t){return t.cardinality_breakdown.Row.length>0?new y(t.cardinality_breakdown.Row):new D("Cardinality","N/A")}(t),void 0,h,12*d.breakdown),a+=12*d.breakdown,++r),this._showPopularPatternsColumn&&(this.setContent(n,a,function(t){return t.popular_patterns.Row.length>0?new C(t.popular_patterns.Row):new D("Popular Patterns","N/A")}(t),void 0,h,12*d.popularPatterns),a+=12*d.popularPatterns,++r),r},e.prototype.update=function(e,i){this.width()<800&&this.width(800),this.height(this._fixedHeight),t.prototype.update.call(this,e,i)},e.prototype.resize=function(e){var i=t.prototype.resize.call(this,e);return this._placeholderElement&&this._placeholderElement.style("height",(this._fixedHeight?this._fixedHeight:this._size.height)+"px"),i},e.prototype.calcStatsWidgetDataColumnWidth=function(){var t=this,e=0;return this._data.forEach((function(i){var n=Math.max(t.textSize(i.numeric_mean).width,t.textSize(i.numeric_std_dev).width,t.textSize(i.numeric_min).width,t.textSize(i.numeric_lower_quartile).width,t.textSize(i.numeric_median).width,t.textSize(i.numeric_upper_quartile).width,t.textSize(i.numeric_max).width);n>e&&(e=n)})),e},e}(n.Grid);M.prototype._class+=" eclwatch_DPReport";var F=function(t){return["attribute","given_attribute_type","best_attribute_type","rec_count","fill_count","fill_rate","cardinality","cardinality_breakdown","modes","min_length","max_length","ave_length","popular_patterns","rare_patterns","is_numeric","numeric_min","numeric_max","numeric_mean","numeric_std_dev","numeric_lower_quartile","numeric_median","numeric_upper_quartile","correlations"].indexOf(t.ColumnName)>0},Q=function(t){return function(t){return t.ECLSchemas.ECLSchemaItem.filter(F).length}(t)>=4},A=function(t){function i(i){var n=t.call(this)||this;n._espUrl=i,n.hideSingleTabs(!0);var r=n._espUrl.split("/WsWorkunits/res/"),a=r[0],o=r[1].split("/report/res/index.html")[0];return n._wu=e.Workunit.attach({baseUrl:a},o),n}return u(i,t),i.prototype.render=function(e){var i=this;return this._prevFetch||(this._prevFetch=this._wu.fetchResults().then((function(t){Promise.all(t.filter(Q).map((function(t){return t.fetchRows().then((function(e){return{result:t,report:new M(e)}}))}))).then((function(t){t.forEach((function(e,n){0===n?i.addWidget(e.report,e.result.Name):i.addWidget(e.report,e.result.Name,"tab-after",t[n-1].report)}))}))}))),this._prevFetch.then((function(){t.prototype.render.call(i,(function(t){e&&e(i)}))})),this},i}(i.DockPanel);t.ReportTabs=A,Object.defineProperty(t,"__esModule",{value:!0})}));