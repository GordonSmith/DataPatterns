define(["exports","@hpcc-js/chart","@hpcc-js/comms","@hpcc-js/layout","@hpcc-js/other","@hpcc-js/html"],function(t,e,n,i,r,o){"use strict";var a,l=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=function(t){return["attribute","given_attribute_type","best_attribute_type","rec_count","fill_count","fill_rate","cardinality","cardinality_breakdown","modes","min_length","max_length","ave_length","popular_patterns","rare_patterns","is_numeric","numeric_min","numeric_max","numeric_mean","numeric_std_dev","numeric_lower_quartile","numeric_median","numeric_upper_quartile","numeric_correlations"].indexOf(t.ColumnName)>0},u=function(t,e){return void 0===e&&(e=4),function(t){return t.ECLSchemas.ECLSchemaItem.filter(s).length}(t)>=e},d={rowHeight:190,primaryFontSize:20,secondaryFontSize:14,primaryColor:"#494949",secondaryColor:"#DDD",offwhiteColor:"#FBFBFB",blueColor:"#1A99D5",redColor:"#ED1C24",fillRateRedThreshold:33},h=function(t){function a(e){var i=t.call(this)||this;i._espUrl=e,i._showBreakdownColumn=!0,i._showPopularPatternsColumn=!0,i._showQuartileColumn=!0,i.gutter(12).surfaceShadow(!1).surfacePadding("0").surfaceBorderWidth(0);var r=i._espUrl.split("/WsWorkunits/res/"),o=r[0],a=r[1].split("/report/res/index.html")[0];return i._wu=n.Workunit.attach({baseUrl:o},a),i}return l(a,t),a.prototype.enter=function(e,n){var i=this;this._fixedHeight=this._data.length*d.rowHeight,e.style.height=this._fixedHeight+"px",this.height(this._fixedHeight),t.prototype.enter.call(this,e,n);var r=this.calcStatsWidgetDataColumnWidth();this._showBreakdownColumn=this._data.filter(function(t){return t.cardinality_breakdown.Row.length>0}).length>0,this._showPopularPatternsColumn=this._data.filter(function(t){return t.popular_patterns.Row.length>0}).length>0,this._showQuartileColumn=this._data.filter(function(t){return t.is_numeric}).length>0;var o=3;this._data.forEach(function(t,e){var n=i.enterDataRow(t,e,{statsDataWidth:r});n>o&&(o=n)}),n.classed("report-col-count-"+o,!0)},a.prototype.enterDataRow=function(t,n,a){var l=n*d.rowHeight,s=0;return this.setContent(l,s++,u(t),void 0,d.rowHeight),this.setContent(l,s++,function(t,e){if(t.is_numeric)return(new o.StyledTable).data([["Mean",t.numeric_mean,""],["Std. Deviation",t.numeric_std_dev,""],["","",""],["Quantiles",t.numeric_min,"Min"],["",t.numeric_lower_quartile,"25%"],["",t.numeric_median,"50%"],["",t.numeric_upper_quartile,"75%"],["",t.numeric_max,"Max"]]).tbodyColumnStyles([{"font-weight":"bold","text-align":"right",width:"100px"},{"font-weight":"normal",width:e+"px"},{"font-weight":"normal",width:"auto"}]);if(t.popular_patterns.Row.length>0)return(new o.StyledTable).data([["Min Length",t.min_length],["Avg Length",t.ave_length],["Max Length",t.max_length]]).tbodyColumnStyles([{"font-weight":"bold","text-align":"right",width:"100px"},{"font-weight":"normal",width:"auto"}]);return u(t)}(t,a.statsDataWidth),void 0,d.rowHeight),this._showBreakdownColumn&&this.setContent(l,s++,function(t){return t.cardinality_breakdown.Row.length>0?(new o.BreakdownTable).columns(["Cardinality Breakdown",""]).data(t.cardinality_breakdown.Row.map(function(t){return[t.value.trim(),t.rec_count]})).theadColumnStyles([{"text-align":"left","font-size":d.secondaryFontSize+"px","white-space":"nowrap"}]).tbodyColumnStyles([{"max-width":"60px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},{"text-align":"right","font-size":d.secondaryFontSize+"px"}]):h("Cardinality Breakdown","N/A")}(t),void 0,d.rowHeight),this._showPopularPatternsColumn&&this.setContent(l,s++,function(t){return t.popular_patterns.Row.length>0?(new o.BreakdownTable).columns(["Popular Patterns",""]).theadColumnStyles([{"text-align":"left","font-size":d.secondaryFontSize+"px","white-space":"nowrap"}]).tbodyColumnStyles([{"max-width":"60px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},{"text-align":"right","font-size":d.secondaryFontSize+"px"}]).data(t.popular_patterns.Row.map(function(t){return[t.data_pattern.trim(),t.rec_count]})):h("Popular Patterns","N/A")}(t),void 0,d.rowHeight),this._showQuartileColumn&&this.setContent(l,s++,function(t){return t.is_numeric?(new e.QuartileCandlestick).columns(["Min","25%","50%","75%","Max"]).data([t.numeric_min,t.numeric_lower_quartile,t.numeric_median,t.numeric_upper_quartile,t.numeric_max]).edgePadding(30).candleWidth(20).roundedCorners(1).lineWidth(1).upperTextRotation(-90).lowerTextRotation(-90):h("Quartile","N/A")}(t),void 0,d.rowHeight),s;function u(t){var e=(new r.Html).html('<span style="\n                    color:'+d.primaryColor+";\n                    padding:8px;\n                    display:inline-block;\n                    font-size:"+d.secondaryFontSize+"px;\n                    margin-top:4px;\n                    border:1px solid "+d.secondaryColor+";\n                    border-radius:4px;\n                    background-color: "+d.offwhiteColor+';\n                    width: calc(100% - 18px);\n                ">\n                    <i style="\n                        font-size:'+d.secondaryFontSize+"px;\n                        color:"+d.blueColor+';\n                    " class="fa '+("string"===t.given_attribute_type.slice(0,6)?"fa-font":"fa-hashtag")+'"></i>\n                    <b>'+t.attribute+'</b>\n                    <span style="float:right;">'+t.given_attribute_type+'</span>\n                </span>\n                <span style="padding:12px 2px;display:inline-block;font-family: Verdana; color: rgb(51, 51, 51); font-weight: bold; font-size: 14px;">\n                    Optimal:\n                </span>\n                <span style="\n                    color:'+d.primaryColor+";\n                    padding:4px 8px;\n                    display:inline-block;\n                    font-size:"+d.secondaryFontSize+"px;\n                    margin-top:4px;\n                    border:1px solid "+d.secondaryColor+";\n                    border-radius:4px;\n                    background-color: "+d.offwhiteColor+';\n                    float:right;\n                ">\n                    <i style="\n                        font-size:'+d.secondaryFontSize+"px;\n                        color:"+d.blueColor+';\n                    " class="fa '+("string"===t.best_attribute_type.slice(0,6)?"fa-font":"fa-hashtag")+'"></i>\n                    '+t.best_attribute_type+"\n                </span>\n                ").overflowX("hidden").overflowY("hidden"),n=100===t.fill_rate||0===t.fill_rate?t.fill_rate:t.fill_rate.toFixed(1),a=(new o.StyledTable).data([["Cardinality",t.cardinality,"(~"+(t.cardinality/t.fill_count*100).toFixed(0)+"%)"],["Filled",t.fill_count,n<=d.fillRateRedThreshold?'(<b style="color:'+d.redColor+'">'+n+"%</b>)":"("+n+"%)"]]).tbodyColumnStyles([{"font-weight":"bold","font-size":d.secondaryFontSize+"px",width:"1%"},{"font-weight":"normal","font-size":d.secondaryFontSize+"px","text-align":"right",width:"auto"},{"font-weight":"normal","font-size":d.secondaryFontSize+"px","text-align":"left",width:"1%"}]);return(new i.Grid).gutter(0).surfaceShadow(!1).surfacePadding("0").surfaceBorderWidth(0).setContent(0,0,e).setContent(1,0,a)}function h(t,e){return(new r.Html).html('\n                    <b style="line-height:23px;font-size:'+d.secondaryFontSize+'px;color: rgb(51, 51, 51);">'+t+'</b>\n                    <br/>\n                    <i style="font-size:'+d.secondaryFontSize+'px;color: rgb(51, 51, 51);">'+e+"</i>\n                ").overflowX("hidden").overflowY("hidden")}},a.prototype.update=function(e,n){this.height(this._fixedHeight),t.prototype.update.call(this,e,n)},a.prototype.resize=function(e){var n=t.prototype.resize.call(this,e);return this._placeholderElement&&this._placeholderElement.style("height",(this._fixedHeight?this._fixedHeight:this._size.height)+"px"),n},a.prototype.render=function(e){var n=this;return this._wu.fetchResults().then(function(t){for(var e=0,n=t;e<n.length;e++){var i=n[e];if(u(i))return i}}).then(function(t){return t?t.fetchRows():[]}).then(function(i){n._data=i,t.prototype.render.call(n,function(t){e&&e(n)})}),this},a.prototype.calcStatsWidgetDataColumnWidth=function(){var t=this,e=0;return this._data.forEach(function(n){var i=Math.max(t.textSize(n.numeric_mean).width,t.textSize(n.numeric_std_dev).width,t.textSize(n.numeric_min).width,t.textSize(n.numeric_lower_quartile).width,t.textSize(n.numeric_median).width,t.textSize(n.numeric_upper_quartile).width,t.textSize(n.numeric_max).width);i>e&&(e=i)}),console.log("ret",e),e},a}(i.Grid);t.Report=h,Object.defineProperty(t,"__esModule",{value:!0})});